# TIL: 데이터베이스
## 학습날짜: 2025년 2월 3일

## What I Learned

### 

```
--특정 종목의 일자별 전일 대비 가격변동 
SELECT 
    asset_id,               -- 자산 ID
    creation_timestamp,     -- 거래 날짜
    PRICE,
    LAG(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp
    ) AS prev_price,  -- 전일 PRICE
    PRICE - LAG(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp
    ) AS price_change -- 전일 대비 가격 변동
FROM ASSET_PRICE_HISTORIES
WHERE ASSET_ID = '1';

--종목별 2025년 1월 31일 기준 52주 최고가 52주 최저가

SELECT 
    asset_id,
    creation_timestamp,
    PRICE,
    MAX(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp 
        ROWS BETWEEN 364 PRECEDING AND CURRENT ROW
    ) AS high_52_weeks,
    MIN(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp 
        ROWS BETWEEN 364 PRECEDING AND CURRENT ROW
    ) AS low_52_weeks
FROM ASSET_PRICE_HISTORIES
WHERE CREATION_TIMESTAMP = TO_TIMESTAMP('2025-01-31', 'YYYY-MM-DD');

--특정 종목의 5일 평균이동
SELECT 
    asset_id,
    creation_timestamp,
    PRICE,
    AVG(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp 
        ROWS BETWEEN 4 PRECEDING AND CURRENT ROW
    ) AS moving_avg_5d
FROM ASSET_PRICE_HISTORIES
WHERE ASSET_ID = '1';
```
