# TIL: 데이터베이스
## 학습날짜: 2025년 2월 3일

## What I Learned

### 조별 활동 중 작성한 통계 쿼리
``` sql
--특정 종목의 일자별 전일 대비 가격변동 
SELECT 
    asset_id,               -- 자산 ID
    creation_timestamp,     -- 거래 날짜
    PRICE,
    LAG(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp
    ) AS prev_price,  -- 전일 PRICE
    PRICE - LAG(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp
    ) AS price_change -- 전일 대비 가격 변동
FROM ASSET_PRICE_HISTORIES
WHERE ASSET_ID = '1';

--종목별 2025년 1월 31일 기준 52주 최고가 52주 최저가

WITH price_history AS (
    SELECT 
        asset_id,
        creation_timestamp,
        price AS current_price,
        MAX(price) OVER (
            PARTITION BY asset_id 
            ORDER BY creation_timestamp 
            RANGE BETWEEN NUMTODSINTERVAL(364, 'DAY') PRECEDING AND CURRENT ROW
        ) AS high_52_weeks,
        MIN(price) OVER (
            PARTITION BY asset_id 
            ORDER BY creation_timestamp 
            RANGE BETWEEN NUMTODSINTERVAL(364, 'DAY') PRECEDING AND CURRENT ROW
        ) AS low_52_weeks
    FROM ASSET_PRICE_HISTORIES
)
SELECT * 
FROM price_history
WHERE TRUNC(creation_timestamp) = DATE '2025-01-31';


--특정 종목의 5일 평균이동
SELECT 
    asset_id,
    creation_timestamp,
    PRICE,
    AVG(PRICE) OVER (
        PARTITION BY asset_id 
        ORDER BY creation_timestamp 
        ROWS BETWEEN 4 PRECEDING AND CURRENT ROW
    ) AS moving_avg_5d
FROM ASSET_PRICE_HISTORIES
WHERE ASSET_ID = '1';
```

### 다른 조 발표를 들으며

- 금융 관련 데이터베이스라는 한정적인 주제이기 때문에 모두가 비슷한 결과를 내보낼 것이라 예상했습니다. 하지만 발표를 모두 들어보니 조 하나 하나 내용이
매우 다른 것을 확인할 수 있었습니다. 덕분에 프로젝트를 하면서도 생각해보지 않았던 내용들에 대해서 다시 생각해 볼 수 있는 계기가 되었습니다.
