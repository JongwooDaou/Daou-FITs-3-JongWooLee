# TIL: JAVA
## 학습날짜: 2025년 2월 12일

## Problem:
- 애매모호한 Layerd architecture의 확장된 MVC 패턴과 DI 개념

## Solution:
- 코드로 직접 구현을 통한 실습

## What I Learned

### Layered Architecture
![image](https://github.com/user-attachments/assets/2ea027b2-4c1a-4a6b-8d5b-22ece34d270b)

- 소프트웨어 개발에서 가장 일반적으로 널리 사용되는 아키텍처, 가장 기본이 되는 구조.
- 구성되는 계층의 숫자에 따라 N 계층 아키텍처 (N-tier Architecture) 라고 하는데 일반적으로는 4계층을 많이 사용.
- 각 계층은 어플리케이션 내에서의 특정 역할과 관심사-`concern`(화면 표시, 비즈니스 로직 수행, DB 작업 등)별로 구분.
- 객체지향의 주요 개념 중 하나인 관심사의 분리(`Separation of Concern`)
- 높은 유지보수성과 쉬운 테스트를 제공.
- 인접한 Layer 끼리만 접근 가능.

### DAO MVC 실습
- step1: 일반적인 DAO (중복 코드 존재)
- step2: 중복된 코드를 method로 분리(추출)
- step3: 추상 method와 추상 class로 만들어서 제공하고 가져가서 사용하는 사람이 상속해서 사용  
- step4: UserDAO를 재사용하려면 반드시 명시적으로 박혀있는 class를 사용해야하는 문제가 있음
- step5: interface와 UserDAO를 제공하여 사용자가 직접 class를 구현하여 사용
- step6: 직접 객체를 생성하지 않고 객체를 injection 받아서 생성(DI - Dependency Injection)

### DI( dependency injection ) 예시
- VO
```java
package di.step6;

public class UserVO {
    private String id;
    private String name;
    private String password;

    public UserVO() {

    }
    public UserVO(String id, String name, String password) {
        this.id = id;
        this.name = name;
        this.password = password;
    }
    // Setter & Getter
    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }
}
```
- method interface
```java
package di.step6;

import java.sql.Connection;
// interface 다른 class 에서 사용에 유연하도록 interface 로 구현
public interface ConnectionMaker {
    public Connection getConnection() throws Exception;
}
```
- method implement
```java
package di.step6;

import java.sql.Connection;
import java.sql.DriverManager;

public class KConnectionMaker implements ConnectionMaker {
    @Override
    public Connection getConnection() throws Exception{

        //  유연하게 사용자가 이용할 수 있도록 자유롭게 구현
        Class.forName("oracle.jdbc.driver.OracleDriver");
        String url = "jdbc:oracle:thin:@localhost:1521:xe";
        String id = "system";
        String pw = "1234";
        Connection con = DriverManager.getConnection(url, id, pw);
        return con;
    }
}
```
- DAO 인터페이스를 활용하여 유연하게 구현현
```java
package di.step6;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

public class UserDAO {
    private ConnectionMaker connectionMaker;

    //  생성자로 dependency injection
    public UserDAO(ConnectionMaker connectionMaker) {
        //  직접 객체를 생성하지 않고 객체를 injection 받아서 생성
        //  DI - dependency injection
        this.connectionMaker = connectionMaker;
    }

    public void insert(UserVO user) {
        try {

            Connection con = connectionMaker.getConnection();

            String sql = "INSERT INTO USERS VALUES (?, ?, ?)";
            PreparedStatement pstmt = con.prepareStatement(sql);
            pstmt.setString(1, user.getId());
            pstmt.setString(2, user.getName());
            pstmt.setString(3, user.getPassword());

            pstmt.executeUpdate();

            pstmt.close();
            con.close();
        } catch (Exception e){
            System.out.println(e.getMessage());
        }
    }
    //  id를 이용해서 사용자 검색하는 기능
    public UserVO select(String userId) {
        UserVO user = new UserVO();
        try {

            Connection con = connectionMaker.getConnection();

            String sql = "SELECT * FROM USERS WHERE ID = ?";
            PreparedStatement pstmt = con.prepareStatement(sql);
            pstmt.setString(1, userId);
            ResultSet rs = pstmt.executeQuery();
            rs.next();

            user = new UserVO(
                    rs.getString(1),
                    rs.getString(2),
                    rs.getString(3)
            );
            pstmt.close();
            con.close();
        } catch (Exception e){
            System.out.println(e.getMessage());
        }
        return user;
    }
}
```
- 실행 실제 class를 생성하는 것을 위임받음음
```java
package di.step6;

public class Main {
    public static void main(String[] args) {
        //  객체 생성 주체를 다른 곳에 위임함
        //  각 class 내부에서는 interface 를 활용하여 유연성을 높임
        ConnectionMaker connectionMaker = new KConnectionMaker();
        UserDAO userDAO = new UserDAO(connectionMaker);

        UserVO user = userDAO.select("HGD");

        System.out.println(user.getName());
    }
}
```

